# ==================================================
# Recipe Scraper Service - Environment Configuration
# ==================================================
# Copy this file to .env and fill in your values
# FREE tier options marked with ðŸ†“
# ==================================================

# --------------------------------------------------
# Database (Supabase - ðŸ†“ FREE tier: 500MB, 2GB transfer)
# --------------------------------------------------
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
SUPABASE_ANON_KEY=your-anon-key
DATABASE_URL=postgresql://postgres:password@db.your-project.supabase.co:5432/postgres

# --------------------------------------------------
# Caching (Upstash Redis - ðŸ†“ FREE tier: 10K commands/day)
# --------------------------------------------------
UPSTASH_REDIS_REST_URL=https://your-redis.upstash.io
UPSTASH_REDIS_REST_TOKEN=your-redis-token

# Optional: Local Redis (if you prefer)
# REDIS_URL=redis://localhost:6379

# --------------------------------------------------
# AI & NLP Services
# --------------------------------------------------

# Google AI (ðŸ†“ FREE tier: 60 requests/min)
GOOGLE_API_KEY=your-google-api-key
GOOGLE_AI_API_KEY=your-google-ai-key  # For Gemini

# Google Vision API (ðŸ†“ FREE tier: 1000 units/month)
GOOGLE_VISION_API_KEY=your-vision-api-key
# OR use service account JSON
# GOOGLE_VISION_KEY_FILE=./google-vision-service-account.json

# --------------------------------------------------
# Nutrition Data (USDA - ðŸ†“ FREE tier: 1000 requests/hour)
# --------------------------------------------------
USDA_API_KEY=your-usda-api-key
# Get free API key at: https://fdc.nal.usda.gov/api-key-signup.html

# --------------------------------------------------
# Cloud Storage for Photos (ðŸ†“ BEST FREE OPTIONS)
# --------------------------------------------------

# OPTION 1: Cloudflare R2 (RECOMMENDED - $0/month, unlimited bandwidth!)
# ðŸ†“ FREE tier: 10GB storage, 10M writes, 100M reads, ZERO egress fees
# Get started: https://dash.cloudflare.com/
CLOUD_STORAGE_PROVIDER=cloudflare-r2  # Options: cloudflare-r2 | supabase | firebase

# Cloudflare R2 Configuration
CLOUDFLARE_ACCOUNT_ID=your-account-id
CLOUDFLARE_ACCESS_KEY_ID=your-access-key-id
CLOUDFLARE_SECRET_ACCESS_KEY=your-secret-access-key
CLOUDFLARE_BUCKET=recipe-images
CLOUDFLARE_PUBLIC_DOMAIN=images.yourdomain.com  # Optional: custom domain for CDN

# OPTION 2: Supabase Storage (Already configured above)
# ðŸ†“ FREE tier: 1GB storage, 2GB bandwidth
# Use SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY above
SUPABASE_STORAGE_BUCKET=recipe-images

# OPTION 3: Firebase Storage (Alternative)
# ðŸ†“ FREE tier: 5GB storage, 1GB/day download
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_STORAGE_BUCKET=your-project.appspot.com
FIREBASE_CREDENTIALS_PATH=./firebase-credentials.json

# Image Processing Settings
STORAGE_MAX_FILE_SIZE=10485760        # 10MB in bytes
STORAGE_DEFAULT_QUALITY=80            # WebP quality (1-100)
STORAGE_CONVERT_TO_WEBP=true          # Auto-convert to WebP
STORAGE_GENERATE_THUMBNAILS=true      # Generate 3 sizes (150px, 500px, 1000px)
STORAGE_CDN_ENABLED=true              # Use CDN for delivery

# --------------------------------------------------
# Optional: Image Processing & OCR
# --------------------------------------------------
IMGUR_CLIENT_ID=your-imgur-client-id

# --------------------------------------------------
# Audio Transcription (Optional - Expensive!)
# --------------------------------------------------
# Google Cloud Speech API
GOOGLE_CLOUD_SPEECH_API_KEY=your-speech-api-key

# OpenAI Whisper API (Alternative)
OPENAI_API_KEY=your-openai-api-key

# Enable/disable audio transcription (disabled by default for cost)
ENABLE_AUDIO_TRANSCRIPTION=false

# --------------------------------------------------
# Performance & Features
# --------------------------------------------------

# Caching
CACHE_ENABLED=true
CACHE_TTL=3600                    # Cache TTL in seconds (1 hour)
ENABLE_MEMORY_CACHE=true          # LRU in-memory cache
ENABLE_REDIS_CACHE=true           # Upstash Redis cache
ENABLE_DB_CACHE=false             # Database cache (optional)

# Processing
MAX_RETRIES=3                     # API retry attempts
TIMEOUT_MS=30000                  # Request timeout (30s)
MAX_CONCURRENT_REQUESTS=5         # Parallel requests
BATCH_SIZE=50                     # Batch processing size

# Enrichment
ENABLE_NUTRITION=true             # Fetch nutrition data
ENABLE_EMBEDDING=false            # Generate embeddings (slow/expensive)
ENABLE_AI_ENRICHMENT=false        # AI-powered enrichment (costs money)

# Features
NO_FILE_CACHE=true                # Disable file-based caching
LITE_MODEL=gemini-1.5-flash-latest  # Use lite AI model for speed

# --------------------------------------------------
# Deployment
# --------------------------------------------------
NODE_ENV=production               # production | development
LOG_LEVEL=info                    # error | warn | info | debug
PORT=3000                         # API server port

# --------------------------------------------------
# Optional: Notifications
# --------------------------------------------------
EMAIL_USERNAME=your-email@gmail.com
EMAIL_PASSWORD=your-app-password
NOTIFICATION_EMAIL=alerts@example.com

# --------------------------------------------------
# Optional: Monitoring
# --------------------------------------------------
SENTRY_DSN=your-sentry-dsn        # Error tracking
JAEGER_ENDPOINT=http://localhost:14268/api/traces  # Distributed tracing

# --------------------------------------------------
# Circuit Breaker Config
# --------------------------------------------------
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=60000     # 1 minute
CIRCUIT_BREAKER_SUCCESS_THRESHOLD=2

# --------------------------------------------------
# Blocked Websites Registry
# --------------------------------------------------
BLOCK_THRESHOLD=5                 # Failures before temporary block
PERMANENT_BLOCK_THRESHOLD=20      # Failures before permanent block
COOLDOWN_PERIOD_MS=3600000        # 1 hour cooldown for temp blocks
